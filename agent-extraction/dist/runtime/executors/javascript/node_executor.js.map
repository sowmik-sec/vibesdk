{
  "version": 3,
  "sources": ["../../../../src/runtime/executors/javascript/node_executor.ts"],
  "sourcesContent": [
    "#!/usr/bin/env node\n\nimport { createRequire } from 'node:module';\nimport { dirname } from 'node:path';\nimport * as readline from 'node:readline';\nimport { fileURLToPath } from 'node:url';\nimport * as util from 'node:util';\nimport * as vm from 'node:vm';\nimport type { RichOutput } from '../../process-pool';\n\n// Create CommonJS-like globals for the sandbox\nconst __filename = fileURLToPath(import.meta.url);\nconst __dirname = dirname(__filename);\nconst require = createRequire(import.meta.url);\n\nconst rl = readline.createInterface({\n  input: process.stdin,\n  output: process.stdout,\n  terminal: false\n});\n\nconst sandbox = {\n  console: console,\n  process: process,\n  require: require,\n  Buffer: Buffer,\n  setTimeout: setTimeout,\n  setInterval: setInterval,\n  clearTimeout: clearTimeout,\n  clearInterval: clearInterval,\n  setImmediate: setImmediate,\n  clearImmediate: clearImmediate,\n  global: global,\n  __dirname: __dirname,\n  __filename: __filename\n};\n\nconst context = vm.createContext(sandbox);\n\nconsole.log(JSON.stringify({ status: 'ready' }));\n\nrl.on('line', async (line: string) => {\n  try {\n    const request = JSON.parse(line);\n    const { code, executionId, timeout } = request;\n\n    const originalStdoutWrite = process.stdout.write;\n    const originalStderrWrite = process.stderr.write;\n\n    let stdout = '';\n    let stderr = '';\n\n    (process.stdout.write as any) = (\n      chunk: string | Buffer,\n      encoding?: BufferEncoding,\n      callback?: () => void\n    ) => {\n      stdout += chunk.toString();\n      if (callback) callback();\n      return true;\n    };\n\n    (process.stderr.write as any) = (\n      chunk: string | Buffer,\n      encoding?: BufferEncoding,\n      callback?: () => void\n    ) => {\n      stderr += chunk.toString();\n      if (callback) callback();\n      return true;\n    };\n\n    let result: unknown;\n    let success = true;\n\n    try {\n      const options: vm.RunningScriptOptions = {\n        filename: `<execution-${executionId}>`\n      };\n\n      // Only add timeout if specified (undefined = unlimited)\n      if (timeout !== undefined) {\n        options.timeout = timeout;\n      }\n\n      result = vm.runInContext(code, context, options);\n    } catch (error: unknown) {\n      const err = error as Error;\n      stderr += err.stack || err.toString();\n      success = false;\n    } finally {\n      process.stdout.write = originalStdoutWrite;\n      process.stderr.write = originalStderrWrite;\n    }\n\n    const outputs: RichOutput[] = [];\n\n    if (result !== undefined) {\n      if (typeof result === 'object' && result !== null) {\n        outputs.push({\n          type: 'json',\n          data: JSON.stringify(result, null, 2),\n          metadata: {}\n        });\n      } else {\n        outputs.push({\n          type: 'text',\n          data: util.inspect(result, {\n            showHidden: false,\n            depth: null,\n            colors: false\n          }),\n          metadata: {}\n        });\n      }\n    }\n\n    const response = {\n      stdout,\n      stderr,\n      success,\n      executionId,\n      outputs\n    };\n\n    console.log(JSON.stringify(response));\n  } catch (error: unknown) {\n    const err = error as Error;\n    console.log(\n      JSON.stringify({\n        stdout: '',\n        stderr: `Error processing request: ${err.message}`,\n        success: false,\n        executionId: 'unknown',\n        outputs: []\n      })\n    );\n  }\n});\n\nprocess.on('SIGTERM', () => {\n  rl.close();\n  process.exit(0);\n});\n\nprocess.on('SIGINT', () => {\n  rl.close();\n  process.exit(0);\n});\n"
  ],
  "mappings": ";AAEA,wBAAS,oBACT,kBAAS,kBACT,gCACA,wBAAS,iBACT,4BACA,0BAIA,IAAM,EAAa,EAAc,YAAY,GAAG,EAC1C,EAAY,EAAQ,CAAU,EAC9B,EAAU,EAAc,YAAY,GAAG,EAEvC,EAAc,kBAAgB,CAClC,MAAO,QAAQ,MACf,OAAQ,QAAQ,OAChB,SAAU,EACZ,CAAC,EAEK,EAAU,CACd,QACA,QACA,QAAS,EACT,OACA,WACA,YACA,aACA,cACA,aACA,eACA,OACA,UAAW,EACX,WAAY,CACd,EAEM,EAAa,gBAAc,CAAO,EAExC,QAAQ,IAAI,KAAK,UAAU,CAAE,OAAQ,OAAQ,CAAC,CAAC,EAE/C,EAAG,GAAG,OAAQ,MAAO,IAAiB,CACpC,GAAI,CACF,IAAM,EAAU,KAAK,MAAM,CAAI,GACvB,OAAM,cAAa,WAAY,EAEjC,EAAsB,QAAQ,OAAO,MACrC,EAAsB,QAAQ,OAAO,MAEvC,EAAS,GACT,EAAS,GAEZ,QAAQ,OAAO,MAAgB,CAC9B,EACA,EACA,IACG,CAEH,GADA,GAAU,EAAM,SAAS,EACrB,EAAU,EAAS,EACvB,MAAO,IAGR,QAAQ,OAAO,MAAgB,CAC9B,EACA,EACA,IACG,CAEH,GADA,GAAU,EAAM,SAAS,EACrB,EAAU,EAAS,EACvB,MAAO,IAGT,IAAI,EACA,EAAU,GAEd,GAAI,CACF,IAAM,EAAmC,CACvC,SAAU,cAAc,IAC1B,EAGA,GAAI,IAAY,OACd,EAAQ,QAAU,EAGpB,EAAY,eAAa,EAAM,EAAS,CAAO,EAC/C,MAAO,EAAgB,CACvB,IAAM,EAAM,EACZ,GAAU,EAAI,OAAS,EAAI,SAAS,EACpC,EAAU,UACV,CACA,QAAQ,OAAO,MAAQ,EACvB,QAAQ,OAAO,MAAQ,EAGzB,IAAM,EAAwB,CAAC,EAE/B,GAAI,IAAW,OACb,GAAI,OAAO,IAAW,UAAY,IAAW,KAC3C,EAAQ,KAAK,CACX,KAAM,OACN,KAAM,KAAK,UAAU,EAAQ,KAAM,CAAC,EACpC,SAAU,CAAC,CACb,CAAC,EAED,OAAQ,KAAK,CACX,KAAM,OACN,KAAW,UAAQ,EAAQ,CACzB,WAAY,GACZ,MAAO,KACP,OAAQ,EACV,CAAC,EACD,SAAU,CAAC,CACb,CAAC,EAYL,QAAQ,IAAI,KAAK,UARA,CACf,SACA,SACA,UACA,cACA,SACF,CAEmC,CAAC,EACpC,MAAO,EAAgB,CAEvB,QAAQ,IACN,KAAK,UAAU,CACb,OAAQ,GACR,OAAQ,6BAJA,EAIiC,UACzC,QAAS,GACT,YAAa,UACb,QAAS,CAAC,CACZ,CAAC,CACH,GAEH,EAED,QAAQ,GAAG,UAAW,IAAM,CAC1B,EAAG,MAAM,EACT,QAAQ,KAAK,CAAC,EACf,EAED,QAAQ,GAAG,SAAU,IAAM,CACzB,EAAG,MAAM,EACT,QAAQ,KAAK,CAAC,EACf",
  "debugId": "3E74C095D96B5A3E64756E2164756E21",
  "names": []
}