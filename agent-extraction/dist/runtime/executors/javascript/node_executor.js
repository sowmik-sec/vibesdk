#!/usr/bin/env node
import{createRequire as $}from"node:module";import{dirname as v}from"node:path";import*as N from"node:readline";import{fileURLToPath as y}from"node:url";import*as Q from"node:util";import*as B from"node:vm";var V=y(import.meta.url),L=v(V),O=$(import.meta.url),F=N.createInterface({input:process.stdin,output:process.stdout,terminal:!1}),P={console,process,require:O,Buffer,setTimeout,setInterval,clearTimeout,clearInterval,setImmediate,clearImmediate,global,__dirname:L,__filename:V},T=B.createContext(P);console.log(JSON.stringify({status:"ready"}));F.on("line",async(X)=>{try{let C=JSON.parse(X),{code:G,executionId:H,timeout:J}=C,Y=process.stdout.write,Z=process.stderr.write,K="",D="";process.stdout.write=(j,A,z)=>{if(K+=j.toString(),z)z();return!0},process.stderr.write=(j,A,z)=>{if(D+=j.toString(),z)z();return!0};let w,M=!0;try{let j={filename:`<execution-${H}>`};if(J!==void 0)j.timeout=J;w=B.runInContext(G,T,j)}catch(j){let A=j;D+=A.stack||A.toString(),M=!1}finally{process.stdout.write=Y,process.stderr.write=Z}let E=[];if(w!==void 0)if(typeof w==="object"&&w!==null)E.push({type:"json",data:JSON.stringify(w,null,2),metadata:{}});else E.push({type:"text",data:Q.inspect(w,{showHidden:!1,depth:null,colors:!1}),metadata:{}});console.log(JSON.stringify({stdout:K,stderr:D,success:M,executionId:H,outputs:E}))}catch(C){console.log(JSON.stringify({stdout:"",stderr:`Error processing request: ${C.message}`,success:!1,executionId:"unknown",outputs:[]}))}});process.on("SIGTERM",()=>{F.close(),process.exit(0)});process.on("SIGINT",()=>{F.close(),process.exit(0)});

//# debugId=3E74C095D96B5A3E64756E2164756E21
